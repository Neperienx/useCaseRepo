{% extends "base.html" %}
{% block content %}
  <section class="panel grid">
    <header>
      <h1>Use case overview</h1>
      <p class="muted">{{ total_records }} records • Filter and explore AI projects tailored to your organisation.</p>
    </header>
    <form method="get" class="filters">
      <div>
        <label for="search">Search</label>
        <input type="text" id="search" name="q" value="{{ search }}" placeholder="Find by title, tags or description">
      </div>
      <div>
        <label for="industry">{{ industry_label }}</label>
        <select id="industry" name="industry">
          <option value="">{{ all_industry_label }}</option>
          {% for option in industries %}
            <option value="{{ option }}" {% if option == selected_industry %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="actions">
        <button class="button" type="submit">Apply</button>
        <a class="button ghost" href="{{ url_for('dashboard') }}">Reset</a>
      </div>
    </form>
  </section>

  {% if use_cases %}
    <section class="cards">
      {% for item in use_cases %}
        <article class="card">
          <header>
            <div class="card-meta">
              {% if can_view_field(item, "status_color") and item.status_color %}
                <span class="status-chip" style="--status-chip-color: {{ item.status_color }}">
                  <span class="status-dot"></span>
                  {{ item.status_color }}
                </span>
              {% endif %}
              {% if can_view_field(item, "industry") and item.industry %}
                <span class="tag">{{ item.industry }}</span>
              {% endif %}
            </div>
            {% if can_view_field(item, "title") %}
              <h3><a href="{{ url_for('use_case_detail', use_case_id=item.id) }}">{{ item.title }}</a></h3>
            {% else %}
              <h3><span class="muted">Restricted use case</span></h3>
            {% endif %}
            {% if can_view_field(item, "requestor") and item.requestor %}
              <p class="muted small"><strong>{{ field_labels.get('requestor', 'Requestor') }}:</strong> {{ item.requestor }}</p>
            {% endif %}
          </header>
          {% if can_view_field(item, "summary") and item.summary %}
            <p>{{ item.summary|truncate(150) }}</p>
          {% endif %}
          {% if can_view_field(item, "impact") and item.impact %}
            <p class="muted small"><strong>{{ field_labels.get('impact', 'Impact') }}:</strong> {{ item.impact }}</p>
          {% endif %}
          {% if can_view_field(item, "data_source") and item.data_source %}
            <p class="muted small"><strong>{{ field_labels.get('data_source', 'Data source') }}:</strong> {{ item.data_source }}</p>
          {% endif %}
          {% if can_view_field(item, "tags") and item.tag_list() %}
            <div class="tag-list">
              {% for tag in item.tag_list() %}
                <span class="tag">{{ tag }}</span>
              {% endfor %}
            </div>
          {% endif %}
          {% if current_user.is_admin %}
            <div class="actions">
              <a class="button ghost" href="{{ url_for('edit_use_case', use_case_id=item.id) }}">Edit</a>
              <form action="{{ url_for('delete_use_case', use_case_id=item.id) }}" method="post">
                <button class="button secondary" type="submit" onclick="return confirm('Delete this record?');">Delete</button>
              </form>
            </div>
          {% endif %}
        </article>
      {% endfor %}
    </section>
  {% else %}
    <section class="panel">
      <h2>No records yet</h2>
      <p class="muted">Use the “New use case” button to add your first entry or import an Excel file.</p>
    </section>
  {% endif %}
{% endblock %}
