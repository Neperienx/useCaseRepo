{% extends "base.html" %}
{% block content %}
  <article class="panel grid">
    <header>
      <a class="button ghost" href="{{ url_for('dashboard') }}">‚Üê Back</a>
      {% if can_view_field(use_case, "title") %}
        <h1>{{ use_case.title }}</h1>
      {% else %}
        <h1>Restricted use case</h1>
      {% endif %}
      <div class="card-meta">
        {% if can_view_field(use_case, "status_color") and use_case.status_color %}
          <span class="status-chip" style="--status-chip-color: {{ use_case.status_color }}">
            <span class="status-dot"></span>
            {{ use_case.status_color }}
          </span>
        {% endif %}
        {% if can_view_field(use_case, "industry") and use_case.industry %}
          <span class="tag">{{ use_case.industry }}</span>
        {% endif %}
      </div>
      {% if can_view_field(use_case, "tags") and use_case.tag_list() %}
        <div class="tag-list">
          {% for tag in use_case.tag_list() %}
            <span class="tag">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}
    </header>

    {% if can_view_field(use_case, "summary") and use_case.summary %}
      <section>
        <h2>{{ field_labels.get('summary', 'Summary') }}</h2>
        <p>{{ use_case.summary }}</p>
      </section>
    {% endif %}

    {% if can_view_field(use_case, "synergy") and use_case.synergy %}
      <section>
        <h2>{{ field_labels.get('synergy', 'Synergy') }}</h2>
        <p>{{ use_case.synergy }}</p>
      </section>
    {% endif %}

    {% if can_view_field(use_case, "problem") and use_case.problem %}
      <section>
        <h2>{{ field_labels.get('problem', 'Problem') }}</h2>
        <p>{{ use_case.problem }}</p>
      </section>
    {% endif %}

    {% if can_view_field(use_case, "solution") and use_case.solution %}
      <section>
        <h2>{{ field_labels.get('solution', 'Solution') }}</h2>
        <p>{{ use_case.solution }}</p>
      </section>
    {% endif %}

    {% if can_view_field(use_case, "impact") and use_case.impact %}
      <section>
        <h2>{{ field_labels.get('impact', 'Impact') }}</h2>
        <p>{{ use_case.impact }}</p>
      </section>
    {% endif %}

    {% if can_view_field(use_case, "data_source") and use_case.data_source %}
      <section>
        <h2>{{ field_labels.get('data_source', 'Data source') }}</h2>
        <p>{{ use_case.data_source }}</p>
      </section>
    {% endif %}

    <section>
      <h2>Owners</h2>
      {% if owners %}
        <ul class="owner-list">
          {% for owner in owners %}
            <li>{{ owner.username }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No owners have been assigned yet.</p>
      {% endif %}

      {% if can_manage_use_case %}
        {% if owner_form and owner_form.user_id.choices %}
          <form method="post" action="{{ url_for('add_use_case_owner', use_case_id=use_case.id) }}" class="owner-form">
            {{ owner_form.hidden_tag() }}
            <div class="form-row">
              {{ owner_form.user_id.label }}
              {{ owner_form.user_id() }}
            </div>
            {{ owner_form.submit(class_='button ghost') }}
          </form>
        {% elif owner_form %}
          <p class="muted">Every user is already an owner of this use case.</p>
        {% endif %}
      {% endif %}
    </section>

    {% if can_manage_use_case %}
      <footer class="actions">
        <a class="button ghost" href="{{ url_for('edit_use_case', use_case_id=use_case.id) }}">Edit</a>
        <form action="{{ url_for('delete_use_case', use_case_id=use_case.id) }}" method="post">
          <button class="button secondary" type="submit" onclick="return confirm('Delete this record?');">Delete</button>
        </form>
      </footer>
    {% endif %}
  </article>
{% endblock %}
